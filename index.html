<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TheraDrive</title>
<style>

h1 {
  text-align: center;
	font-family: Arial,Helvetica Neue,Helvetica,sans-serif;
	font-size: 24px;
	font-style: normal;
	font-variant: normal;
	font-weight: 500;
	line-height: 26.4px;
}

svg {
  margin: auto;
}

.line {
  fill: none;
  stroke: #000;
  stroke-width: 5.0px;
}

#cursor {
  fill: red;
  stroke: red;
  stroke-width: 3.0px;
}

</style>
</head>
<body>
  <h1>TheraDrive GUI: Mode 2 Test</h1>
  <div id="trackingTask"></div>
  <script>
    const ipcRenderer = require('electron').ipcRenderer;
    const d3 = require('d3');

    var trajDim = 100;

    var trajData = new Array(trajDim).fill(0);

    var margin = {top: 30, bottom: 30, left: 50, right: 50},
        height = 700 - margin.top - margin.bottom,
        width = 1000 - margin.left - margin.right;

    var cursorYHeight = 25;
    var cursorYBaseline = height + margin.top;
    var cursorXRadius = 15;

    var xDomain = [-100, 100],
        tDomain = [0, 5];

    var x = d3.scale.linear()
        .domain(xDomain)
        .range([0, width]);

    var t = d3.scale.linear()
        .domain(tDomain)
        .range([0, height]);

    var drawTraj = d3.svg.line()
        .x(function (d) { return margin.left + x(d); })
        .y(function (d, i) { return t(i); })
        .interpolate("basis");

    var drawTriangle = function(d) {
        return 'M ' + x(d) + ' ' + cursorYBaseline + ' l ' + -cursorXRadius + ' ' + cursorYHeight + ' l ' + 2*cursorXRadius + ' 0 z'
    }

    var taskDisplay = d3.select("#trackingTask").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .style("margin-left", -margin.left + "px");

    var traj = taskDisplay.append("path")
        .attr("id", "traj")
        .attr("class", "line")
        .datum(trajData)
        .attr("d", drawTraj);

    var cursor = taskDisplay.append("path")
        .attr("id", "cursor")
        .datum(300)
        .attr("d", drawTriangle);

    ipcRenderer.on('ready-to-draw', function(event, msg) {
        console.log('page loaded!');
        //taskDisplay.select("path")
    });

    ipcRenderer.on('new-traj-data', function(event, data) {
        trajData.shift();
        trajData.push(data);
        traj
            .attr("d", drawTraj);
    });
    ipcRenderer.on('cursor', function(event, data) {
        cursor
            .datum(data)
            .attr("d", drawTriangle);
    });
  </script>
</body>
</html>
